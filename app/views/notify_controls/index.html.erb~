<h1>Notification Controls</h1>

<p>Values in this table specify how often, in hours, the person(s) in the "Who" column should be notified for each of the conditions.</p>
<p>Click on the Device Name to see all alerts for that device. Click on the Device Serail number to edit settings for that device.</p>

<table class="list">
  <tr>
    <th></th>
    <th>Device Name</th>
    <th>Who</th>
    <th>Jam</th>
    <th>Toner<br />Low</th>
    <th>Toner<br />Empty</th>
    <th>Paper</th>
    <th>Service</th>
    <th>Maint.</th>
    <th>Waste<br />Almost Full</th>
    <th>Waste<br />Full</th>
    <th>Job Log<br />Full</th>
  </tr>
  <%= form_tag batch_edit_notify_controls_url, :method => :get do %>
  <% for notify_control in @notify_controls %>
    <tr class="<%=cycle('dark','light')%>">
      <td><%= check_box_tag "sel[#{notify_control.id}]", notify_control.id %>
      <td>
        <% if notify_control.alerts.empty? %>
          &lt;no device&gt;
        <% else %>
          <%= link_to h(notify_control.alerts[-1].device_name), alerts_path + "?name_q=#{notify_control.alerts[-1].device_name}&commit=Find", :title => "Click to view all alerts for this device" %>
        <% end %>
      </td>
      <td><%=h notify_control.who %></td>
      <td>
        <% unless notify_control.jam_sent.nil? %>
          <span title="Last notice sent: <%=h notify_control.jam_sent.to_formatted_s(:db) -%>", class="alert_sent"><%=h notify_control.jam %></span>
        <% else %>
          <span><%=h notify_control.jam %></span>
        <% end %>
      </td>
      <td>
        <% unless notify_control.toner_low_sent.nil? %>
          <span title="Last notice sent: <%=h notify_control.toner_low_sent.to_formatted_s(:db) -%>" class="alert_sent"><%=h notify_control.toner_low %></span>
        <% else %>
          <span><%=h notify_control.toner_low %></span>
        <% end %>
      </td>
      <td>
        <% unless notify_control.toner_empty_sent.nil? %>
          <span title="Last notice sent: <%=h notify_control.toner_empty_sent.to_formatted_s(:db) -%>" class="alert_sent"><%=h notify_control.toner_empty %></span>
        <% else %>
          <span><%=h notify_control.toner_empty %></span>
        <% end %>
      </td>
      <td>
        <% unless notify_control.paper_sent.nil? %>
          <span title="Last notice sent: <%=h notify_control.paper_sent.to_formatted_s(:db) -%>" class="alert_sent"><%=h notify_control.paper %></span>
        <% else %>
          <span><%=h notify_control.paper %></span>
        <% end %>
      </td>
      <td>
        <% unless notify_control.service_sent.nil? %>
          <span title="Last notice sent: <%=h notify_control.service_sent.to_formatted_s(:db) -%>" class="alert_sent"><%=h notify_control.service %></span>
        <% else %>
          <span><%=h notify_control.service %></span>
        <% end %>
      </td>
      <td>
        <% unless notify_control.pm_sent.nil? %>
          <span title="Last notice sent: <%=h notify_control.pm_sent.to_formatted_s(:db) -%>" class="alert_sent"><%=h notify_control.pm %></span>
        <% else %>
          <span><%=h notify_control.pm %></span>
        <% end %>
      </td>
      <td>
        <% unless notify_control.waste_almost_full_sent.nil? %>
          <span title="Last notice sent: <%=h notify_control.waste_almost_full_sent.to_formatted_s(:db) -%>" class="alert_sent"><%=h notify_control.waste_almost_full %></span>
        <% else %>
          <span><%=h notify_control.waste_almost_full %></span>
        <% end %>
      </td>
      <td>
        <% unless notify_control.waste_full_sent.nil? %>
          <span title="Last notice sent: <%=h notify_control.waste_full_sent.to_formatted_s(:db) -%>" class="alert_sent"><%=h notify_control.waste_full %></span>
        <% else %>
          <span><%=h notify_control.waste_full %></span>
        <% end %>
      </td>
      <td>
        <% unless notify_control.job_log_full_sent.nil? %>
          <span title="Last notice sent: <%=h notify_control.job_log_full_sent.to_formatted_s(:db) -%>" class="alert_sent"><%=h notify_control.job_log_full %></span>
        <% else %>
          <span><%=h notify_control.job_log_full %></span>
        <% end %>
      </td>
      <td><%= link_to 'Edit', edit_notify_control_path(notify_control), :title => "Click to edit controls for this device" %></td>
    </tr>
  <% end %>
  <%= submit_tag "Batch Edit Selected" %>
  <% end %>
</table>

<p><%= will_paginate @notify_controls %></p>
